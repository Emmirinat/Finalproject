var currentScene = 1;

//bitmoji 1 code
var drawBitmoji1= function(Xpos,Ypos,bitmojiHeight){
    noStroke();
    
    fill(181, 144, 85);//fill hair
    ellipse(Xpos - (bitmojiHeight/150*31), Ypos + (bitmojiHeight/150*33), bitmojiHeight/150*15, bitmojiHeight/150*44);
    fill(255,220,180);//fill skin
    ellipse(Xpos, Ypos, bitmojiHeight/150*64, bitmojiHeight/150*81);//head
    
    //hair
    fill(181, 144, 85);//fill hair
    quad(Xpos - (bitmojiHeight/150*35), Ypos, Xpos - (bitmojiHeight/150*30), Ypos - (bitmojiHeight/150*32), Xpos - (bitmojiHeight/150*16), Ypos - (bitmojiHeight/150*40), Xpos - (bitmojiHeight/150*30), Ypos - (bitmojiHeight/150*8));//left hair
    quad(Xpos + (bitmojiHeight/150*35), Ypos - (bitmojiHeight/150*11),Xpos + (bitmojiHeight/150*29), Ypos - (bitmojiHeight/150*32), Xpos + (bitmojiHeight/150*18), Ypos - (bitmojiHeight/150*39), Xpos + (bitmojiHeight/150*34), Ypos);//right hair
    ellipse(Xpos, Ypos - (bitmojiHeight/150*34), bitmojiHeight/150*58, bitmojiHeight/150*14);//top hair
    
    //eyes
    fill(105, 92, 58);//fill eyes
    ellipse(Xpos - (bitmojiHeight/150*12), Ypos - (bitmojiHeight/150*5), bitmojiHeight/150*11, bitmojiHeight/150*8);
    ellipse(Xpos + (bitmojiHeight/150*11),Ypos - (bitmojiHeight/150*5), bitmojiHeight/150*11, bitmojiHeight/150*8);
    fill(0, 0, 0);//fill insid eyes
    ellipse(Xpos - (bitmojiHeight/150*12), Ypos - (bitmojiHeight/150*5), bitmojiHeight/150*3, bitmojiHeight/150*3);
    ellipse(Xpos + (bitmojiHeight/150*11), Ypos - (bitmojiHeight/150*5), bitmojiHeight/150*3, bitmojiHeight/150*3);
    
    //nose
    fill(214, 178, 137);//fill nose
    ellipse(Xpos - (bitmojiHeight/150*3), Ypos + (bitmojiHeight/150*12), bitmojiHeight/150*6, bitmojiHeight/150*4);
    ellipse(Xpos + (bitmojiHeight/150*3), Ypos + (bitmojiHeight/150*12), bitmojiHeight/150*6, bitmojiHeight/150*4);
    ellipse(Xpos, Ypos + (bitmojiHeight/150*8), bitmojiHeight/150*5, bitmojiHeight/150*12);
    
    //mouth
    stroke(235, 91, 91);//lips
    fill(255, 255, 255);//fill teeth
    arc(Xpos, Ypos + (bitmojiHeight/150*24), bitmojiHeight/150*24, bitmojiHeight/150*13, 0, 180);//mouth
    line(Xpos - (bitmojiHeight/150*13),Ypos + (bitmojiHeight/150*24), Xpos + (bitmojiHeight/150*12), Ypos + (bitmojiHeight/150*24));
    
    //shirt
    noStroke();
    fill(43, 52, 237);
    rect(Xpos - (bitmojiHeight/150*41),Ypos + (bitmojiHeight/150*40), bitmojiHeight/150*84, bitmojiHeight/150*48);
    
    fill(255, 255, 255);
    textSize(bitmojiHeight/150*38);
    text("ER1", Xpos - (bitmojiHeight/150*34), Ypos + (bitmojiHeight/150*78));
};

//bitmoji 2 code
var drawBitmoji2= function(Xpos,Ypos,bitmojiHeight){
    noStroke();
    
    fill(181, 144, 85);//fill hair
    ellipse(Xpos - (bitmojiHeight/150*31), Ypos + (bitmojiHeight/150*33), bitmojiHeight/150*15, bitmojiHeight/150*44);
    fill(255,220,180);//fill skin
    ellipse(Xpos, Ypos, bitmojiHeight/150*64, bitmojiHeight/150*81);//head
    
    //hair
    fill(181, 144, 85);//fill hair
    quad(Xpos - (bitmojiHeight/150*35), Ypos, Xpos - (bitmojiHeight/150*30), Ypos - (bitmojiHeight/150*32), Xpos - (bitmojiHeight/150*16), Ypos - (bitmojiHeight/150*40), Xpos - (bitmojiHeight/150*30), Ypos - (bitmojiHeight/150*8));//left hair
    quad(Xpos + (bitmojiHeight/150*35), Ypos - (bitmojiHeight/150*11),Xpos + (bitmojiHeight/150*29), Ypos - (bitmojiHeight/150*32), Xpos + (bitmojiHeight/150*18), Ypos - (bitmojiHeight/150*39), Xpos + (bitmojiHeight/150*34), Ypos);//right hair
    ellipse(Xpos, Ypos - (bitmojiHeight/150*34), bitmojiHeight/150*58, bitmojiHeight/150*14);//top hair
    
    //eyes
    fill(105, 92, 58);//fill eyes
    ellipse(Xpos - (bitmojiHeight/150*12), Ypos - (bitmojiHeight/150*5), bitmojiHeight/150*11, bitmojiHeight/150*8);
    ellipse(Xpos + (bitmojiHeight/150*11),Ypos - (bitmojiHeight/150*5), bitmojiHeight/150*11, bitmojiHeight/150*8);
    fill(0, 0, 0);//fill insid eyes
    ellipse(Xpos - (bitmojiHeight/150*12), Ypos - (bitmojiHeight/150*5), bitmojiHeight/150*3, bitmojiHeight/150*3);
    ellipse(Xpos + (bitmojiHeight/150*11), Ypos - (bitmojiHeight/150*5), bitmojiHeight/150*3, bitmojiHeight/150*3);
    
    //nose
    fill(214, 178, 137);//fill nose
    ellipse(Xpos - (bitmojiHeight/150*3), Ypos + (bitmojiHeight/150*12), bitmojiHeight/150*6, bitmojiHeight/150*4);
    ellipse(Xpos + (bitmojiHeight/150*3), Ypos + (bitmojiHeight/150*12), bitmojiHeight/150*6, bitmojiHeight/150*4);
    ellipse(Xpos, Ypos + (bitmojiHeight/150*8), bitmojiHeight/150*5, bitmojiHeight/150*12);
    
    //mouth
    stroke(235, 91, 91);//lips
    fill(255, 255, 255);//fill teeth
    arc(Xpos, Ypos + (bitmojiHeight/150*24), bitmojiHeight/150*24, bitmojiHeight/150*13, 0, 180);//mouth
    line(Xpos - (bitmojiHeight/150*13),Ypos + (bitmojiHeight/150*24), Xpos + (bitmojiHeight/150*12), Ypos + (bitmojiHeight/150*24));
    
    //shirt
    noStroke();
    fill(199, 82, 32);
    rect(Xpos - (bitmojiHeight/150*41),Ypos + (bitmojiHeight/150*40), bitmojiHeight/150*84, bitmojiHeight/150*48);
    
    fill(255, 255, 255);
    textSize(bitmojiHeight/150*38);
    text("ER2", Xpos - (bitmojiHeight/150*34), Ypos + (bitmojiHeight/150*78));
};

//first scene = opening scene 
var drawScene1 = function() {
    currentScene = 1;
    background(179, 179, 179);
    fill(0, 0, 0);
    textSize(25);
    //title
    text("Rocks Attack", 128, 45);
    textSize(15);
    //description
    text("How to play the game?", 50,100);
    textSize(12);
    text("You can move your bitmoji using keyboards. \nPlayer 1 uses the arrorws, player 2 uses the AWSD keys.\nThe goal of the game is to avoid the rocks and to grab to stars.\nYou get 2 points if you hit a star, and lose 1 if get hit by a rock.\nThe first player that reach 30 point, WINS!!", 50,120);
    textSize(20);
    text("By: Emma Rinat", 20, 370);
    textSize(15);
    drawBitmoji1(84, 249, 130);
};

//second scene= app scene
var drawScene2 = function() {
    currentScene = 2;
};

var bomsSpeed = [];//array for bombs speed
var starsSpeed = [];//array for stars speed
var numBoms = 300;//number of bombs
var numStars = 200;//number of stars

//bitmoji 1 object class
var Bitmoji1 = function(x, y) {
    this.x = x;
    this.y = y;
    this.score = 0;
};

Bitmoji1.prototype.draw = function() {
    this.y = constrain(this.y, 12, height-30);
    this.x = constrain(this.x, 10, width-10);
    drawBitmoji1(this.x, this.y, 50, 50);
};

Bitmoji1.prototype.up = function() {
    drawBitmoji1(this.x, this.y, 50, 50);
    this.y -= 5;
};

Bitmoji1.prototype.down = function() {
    drawBitmoji1(this.x, this.y, 50, 50);
    this.y += 5;
};

Bitmoji1.prototype.right = function() {
    drawBitmoji1(this.x, this.y, 50, 50);
    this.x += 5;
};

Bitmoji1.prototype.left = function() {
    drawBitmoji1(this.x, this.y, 50, 50);
    this.x -= 5;
};

//bitmoji 2 object class
var Bitmoji2 = function(x, y) {
    this.x = x;
    this.y = y;
    this.score = 0;
};

Bitmoji2.prototype.draw = function() {
    this.y = constrain(this.y, 12, height-30);
    this.x = constrain(this.x, 10, width-10);
    drawBitmoji2(this.x, this.y, 50, 50);
};

Bitmoji2.prototype.up = function() {
    drawBitmoji2(this.x, this.y, 50, 50);
    this.y -= 5;
};

Bitmoji2.prototype.down = function() {
    drawBitmoji2(this.x, this.y, 50, 50);
    this.y += 5;
};

Bitmoji2.prototype.right = function() {
    drawBitmoji2(this.x, this.y, 50, 50);
    this.x += 5;
};

Bitmoji2.prototype.left = function() {
    drawBitmoji2(this.x, this.y, 50, 50);
    this.x -= 5;
};

//bombs object class
var Boms = function(x, y) {
    this.x = x;
    this.y = y;
};

Boms.prototype.draw = function() {
    image(getImage("cute/Rock"), this.x, this.y , 30, 30);
};

//bomb's initial position and speed
var boms = [];
for (var i = 0; i < numBoms; i++) {  
    boms.push(new Boms(i * 100 + 500, random(0, 380)));
    bomsSpeed.push(random(3,6));
}

//bitmoji players 
var bitmoji1 = new Bitmoji1(365,180);
var bitmoji2 = new Bitmoji2(35, 380);

//bitmoji1 hit bomb, score -1 and the bomb is gone 
Bitmoji1.prototype.checkForBomsHit = function(boms){
    if ((boms.x >= (bitmoji1.x - 20) && boms.x <= (bitmoji1.x + 20)) &&
        (boms.y >= (bitmoji1.y -25) && boms.y <= (bitmoji1.y + 25))) {
        boms.y = -400;
        this.boms++;
        bitmoji1.score -=1;
    }
};

//bitmoji2 hit bomb, score -1 and the bomb is gone 
Bitmoji2.prototype.checkForBomsHit = function(boms){
    if ((boms.x >= (bitmoji2.x - 20) && boms.x <= (bitmoji2.x + 20)) &&
        (boms.y >= (bitmoji2.y -25) && boms.y <= (bitmoji2.y + 25))) {
        boms.y = -400;
        this.boms++;
        bitmoji2.score -=1;
    }
};

//stars object class
var Stars = function(x, y) {
    this.x = x;
    this.y = y;
};

Stars.prototype.draw = function() {
    image(getImage("cute/Star"), this.x, this.y , 30, 30);
};

//star's initial position and speed
var stars = [];
for (var i = 0; i < numStars; i++) {  
    stars.push(new Stars(i * 100 + 500, random(0, 380)));
    starsSpeed.push(random(1,4));
}

//bimoji1 hit stars, score +2 and the star is gone 
Bitmoji1.prototype.checkForStarsHit = function(stars){
    if ((stars.x >= (bitmoji1.x - 20) && stars.x <= (bitmoji1.x + 20)) &&
        (stars.y >= (bitmoji1.y -25) && stars.y <= (bitmoji1.y + 25))) {
        stars.y = -400;
        this.stars++;
        bitmoji1.score +=2;
    }
};

//bimoji2 hit stars, score +2 and the star is gone
Bitmoji2.prototype.checkForStarsHit = function(stars){
    if ((stars.x >= (bitmoji2.x - 20) && stars.x <= (bitmoji2.x + 20)) &&
        (stars.y >= (bitmoji2.y -25) && stars.y <= (bitmoji2.y + 25))) {
        stars.y = -400;
        this.stars++;
        bitmoji2.score +=2;
    }
};

//button object class
var Button = function(config) {
    this.x = config.x || 0;
    this.y = config.y || 0;
    this.width = config.width || 90;
    this.height = config.height || 35;
    this.label = config.label || "Click";
};

Button.prototype.draw = function() {
    fill(0, 0, 0);
    rect(this.x, this.y, this.width, this.height, 5);
    fill(255, 255, 255);
    textSize(25);
    text(this.label, this.x + 20, this.y + 26);
};

Button.prototype.isMouseInside = function() {
    return mouseX > this.x &&
           mouseX < (this.x + this.width) &&
           mouseY > this.y &&
           mouseY < (this.y + this.height);
};

//starts the game 
var start = new Button({
    x: 295,
    y: 300,
    label: "Start"
});

//click the button 
mouseClicked = function() {
    if (start.isMouseInside()) {
        drawScene2();
    }
};

//draw function that draws the first scene if current scene is 1, if the current scene is not 1, then it draws the app scene
var draw = function(){
    if(currentScene === 1){
    drawScene1();
    start.draw();
    } else{
        background(24, 46, 135);
        stroke(0, 0, 0);
        fill(255, 255, 255);
        //score display
        text("Player 1 score: " + bitmoji1.score, 20, 25); 
        text("Player 2 score: " + bitmoji2.score, 20, 50);
        
        //draws bombs
        for (var i = 0; i < boms.length; i++) {
                boms[i].draw();
                boms[i].x -= bomsSpeed[i];
                bitmoji1.checkForBomsHit(boms[i]);
                bitmoji2.checkForBomsHit(boms[i]);
        }
         
        //draws stars    
        for (var i = 0; i < stars.length; i++) {
                stars[i].draw();
                stars[i].x -= starsSpeed[i];
                bitmoji1.checkForStarsHit(stars[i]);
                bitmoji2.checkForStarsHit(stars[i]);
        }
        
        //UI, bitmoji1's movment
        if (keyIsPressed && keyCode === UP) {
            bitmoji1.up();
        } else if(keyIsPressed && keyCode === DOWN) {
            bitmoji1.down();
        } else if(keyIsPressed && keyCode === RIGHT) {
            bitmoji1.right();
        } else if(keyIsPressed && keyCode === LEFT) {
            bitmoji1.left();
            
        }
        bitmoji1.draw();
        
        //UI, bitmoji2's movment
        if (keyIsPressed && key.code === 119) {
            bitmoji2.up();
        } else if(keyIsPressed && key.code === 115) {
            bitmoji2.down();
        } else if(keyIsPressed && key.code === 100) {
            bitmoji2.right();
        } else if(keyIsPressed && key.code === 97) {
            bitmoji2.left();
        }
        bitmoji2.draw();
        
        //ends the game
        if(bitmoji1.score >= 30 || bitmoji2.score >= 30){
            textSize(25);
            fill(255, 255, 255);
            text("Game's over", 120, 180);
            stars.length = 0;
            boms.length = 0;
        }
        textSize(20);
        if(bitmoji1.score >= 30) {
            text("Player 1 won!", 130, 220);
        } else if (bitmoji2.score >= 30){
            text("Player 2 won!", 130, 220);
        }
    }
};
